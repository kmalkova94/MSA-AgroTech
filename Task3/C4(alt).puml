@startuml Диаграмма кода C4 Behavior Analyzer service
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4.puml

title Behavior analyzer service code diagram

class KafkaConsumer {
    -behaviorAnalyzerService : BehaviorAnalyzerService
    +listen(RawEvent)
}

class KafkaProducer {
    +sendBehaviorMetrics()
    +sendAbnormalBehaviorMetrics()
}

class BehaviorAnalyzerController {
    +getBehaviorMetrics()
    +getAnimalBehaviorHistory(UUID)
}

class BehaviorAnalyzerService {
    -behaviorDAO : AnimalBehaviorDAO
    -kafkaTemplate : KafkaTemplate
    +processEvent(RawEvent)
    +analyzeMovementPatterns()
    +detectAbnormalBehavior()
    +detectSocialInteractions()
}

interface AnimalBehaviorDAO {
    +findByAnimalId(UUID) : BehaviorMetrics
    +saveMetrics(BehaviorMetrics)
    +findAbnormalPatterns()
}

class AnimalBehaviorEvent {
    -animalId : UUID
    -timestamp : LocalDateTime
    -movementPattern : MovementPatterns 
    -healthCorrelation : Double
}

class BehaviorMetrics {
    -normalBehaviorScore : Double
    -abnormalBehaviorCount : Integer 
    -socialInteractionIndex : Double 
}

enum MovementPattern {
    GRAZING
    RESTING
    MOVING
    ISOLATED
}

class BehaviorAnalyzerRequest {
    -animalId : UUID 
    -startTime : LocalDateTime
    -endTime : LocalDateTime
}

class BehaviorAnalyzerResponse {
    -metrics : List<BehaviorMetrics>
    -recommendations : List<String>
}

BehaviorAnalyzerController --> BehaviorAnalyzerService : "call"
BehaviorAnalyzerService --> AnimalBehaviorDAO : "get/save Metrics"
BehaviorAnalyzerService --> KafkaProducer : send aggregated events
BehaviorAnalyzerController --> BehaviorAnalyzerRequest : "use"
BehaviorAnalyzerController --> BehaviorAnalyzerResponse : "use"
AnimalBehaviorEvent --> MovementPattern : "use"
KafkaConsumer --> BehaviorAnalyzerService : "call BehaviorAnalyzerService to handle raw events"
AnimalBehaviorDAO --> BehaviorMetrics : "get/save metrics"
BehaviorAnalyzerService --> AnimalBehaviorEvent : "event with aggregated data"

@enduml